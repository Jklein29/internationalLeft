{
    "collab_server" : "",
    "contents" : "# Load packages & data\n\nlibrary(shiny)\nlibrary(ggplot2)\nlibrary(tidyverse)\nlibrary(ggrepel)\nlibrary(survey)\nlibrary(rvest)\nlibrary(plyr)\nlibrary(broom)\nlibrary(knitr)\nlibrary(RCurl)\nlibrary(stargazer)\nlibrary(reshape2)\n\nurl <- getURL(\"https://raw.githubusercontent.com/jordan-klein/internationalLeft/master/W_EVS_clean.csv\")\nW_EVS <- read.csv(text = url)\n\nfilter(W_EVS, !is.na(self_ideo) & !is.na(RacRes_n) & !is.na(edu) & !is.na(generation)) %>% \n  mutate(country_wave = droplevels(country_wave)) -> W_EVS\n\ncw_list <- W_EVS %>% dlply('country_wave')\n\nlapply(cw_list, function(x) {\n  table(x$generation) < 50\n}) %>% \n  do.call(rbind, .) %>% \n  melt() -> gen_index\n\nleft_join(W_EVS, gen_index, by = c(\"country_wave\" = \"Var1\", \"generation\" = \"Var2\")) %>% \nfilter(value == F) -> W_EVS\n\n# Define UI\n\nui <- navbarPage(\"Model selection\", \n                 tabPanel(\"Not adjusted for education\", \n                          titlePanel(\"Racial Resentment and Ideological Self-Placement\"), \n                          sidebarLayout(position = \"right\", \n                                        sidebarPanel(\n                                          selectInput(\"country_wave1\", label = \"Country & survey year\", \n                                                      choices = levels(W_EVS$country_wave), \n                                                      selected = \"United States 2011\")), \n                                        mainPanel(plotOutput(\"n_edu_plot\")))), \n                 tabPanel(\"Adjusted for education\", \n                          titlePanel(\"Racial Resentment and Ideological Self-Placement\"),\n                          sidebarLayout(position = \"right\", \n                                        sidebarPanel(\n                                          selectInput(\"country_wave2\", label = \"Country & survey year\", \n                                                      choices = levels(W_EVS$country_wave), \n                                                      selected = \"United States 2011\")), \n                                        mainPanel(plotOutput(\"edu_plot\")))))\n\n# Define server\n\nserver <- function(input, output) {\n  \n  filter1 <- reactive({\n    filter(W_EVS) %>% \n      filter(country_wave == input$country_wave1)\n  })\n  \n  output$n_edu_plot <- renderPlot({\n    filter1() %>% \n      ggplot(aes(x = RacRes_n, y = self_ideo, colour = generation)) + \n      geom_smooth(method = \"glm\", aes(weight = S017)) + \n      labs(caption = \"Linear regression plots stratified by generation\", colour = \"Generation (years born)\") + \n      scale_x_continuous(\"Racial Resentment (low to high)\", breaks = c(0, .2, .4, .6, .8, 1)) + \n      scale_y_continuous(\"Ideological self-placement (left to right)\", breaks = c(1, 4, 7, 10)) + \n      theme(axis.title.x = element_text(size = 15), axis.title.y = element_text(size = 15)) + \n      coord_cartesian(xlim = c(.2, .8), ylim = c(1, 10)) + \n      scale_color_discrete(breaks = c(\"Greatest\", \"Silent\", \"Boomers\", \"Gen X\", \"Millennials\"), \n                           labels = c(\"Greatest (pre-1928)\", \"Silent (1928-1945)\", \"Boomers (1946-1964)\", \n                                      \"Gen X (1965-1980)\", \"Millennials (1981-1996)\"))\n  })\n  \n  filter2 <- reactive({\n    filter(W_EVS) %>% \n      filter(country_wave == input$country_wave2)\n  })\n  \n  output$edu_plot <- renderPlot({\n    filter2() %>% \n      ggplot(aes(x = resid(lm(RacRes_n ~ edu, weights = S017)), \n                 y = resid(lm(self_ideo ~ edu, weights = S017)), colour = generation)) + \n      geom_smooth(method = \"glm\") + \n      labs(caption = \"Partial multiple linear regression plots adjusted for education, stratified by generation\", \n           colour = \"Generation (years born)\") + \n      scale_x_continuous(\"Racial Resentment (low to high, residuals)\", breaks = c(-.5, -.3, -.1, .1, .3, .5)) + \n      scale_y_continuous(\"Ideological self-placement (left to right, residuals)\", breaks = c(-4.5, -1.5, 1.5, 4.5)) + \n      theme(axis.title.x = element_text(size = 15), axis.title.y = element_text(size = 15)) + \n      coord_cartesian(xlim = c(-.3, .3), ylim = c(-4.5, 4.5)) + \n      scale_color_discrete(breaks = c(\"Greatest\", \"Silent\", \"Boomers\", \"Gen X\", \"Millennials\"), \n                           labels = c(\"Greatest (pre-1928)\", \"Silent (1928-1945)\", \"Boomers (1946-1964)\", \n                                      \"Gen X (1965-1980)\", \"Millennials (1981-1996)\"))\n  })\n  \n}\n\n# Run the application \nshinyApp(ui = ui, server = server)\n",
    "created" : 1555476116198.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "12309069",
    "id" : "19D71B43",
    "lastKnownWriteTime" : 1555539123,
    "last_content_update" : 1555539123420,
    "path" : "~/Documents/WVS/s_ideo_rac/app.R",
    "project_path" : "s_ideo_rac/app.R",
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}