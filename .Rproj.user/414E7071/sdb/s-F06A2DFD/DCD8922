{
    "collab_server" : "",
    "contents" : "# Load packages & data\n\nlibrary(shiny)\nlibrary(ggplot2)\nlibrary(tidyverse)\nlibrary(ggrepel)\nlibrary(survey)\nlibrary(rvest)\nlibrary(plyr)\nlibrary(broom)\nlibrary(knitr)\nlibrary(RCurl)\nlibrary(stargazer)\nlibrary(reshape2)\nlibrary(gridExtra)\nlibrary(ggiraph)\n\nurl <- getURL(\"https://raw.githubusercontent.com/jordan-klein/internationalLeft/master/W_EVS_clean.csv\")\nW_EVS <- read.csv(text = url)\n\ncw_list <- W_EVS %>% dlply('country_wave')\n\n# Create coefficient matrix\n\nlapply(cw_list, function(x) {\n  filter(x, !is.na(self_ideo) & !is.na(ec_ideo))\n}) %>% \n  .[sapply(., function(x) {\n    dim(x)[1] > 0\n  })] %>% \n  lapply(function(x) {\n    model <- lm(self_ideo ~ ec_ideo, data = x, weights = S017)\n    return(data.frame(s_id_econ = model$coefficients[2]))\n  }) %>% \n  do.call(rbind.data.frame, .) %>% \n  data.frame(country_wave = row.names(.), .) -> s_id_econ\n\nlapply(cw_list, function(x) {\n  filter(x, !is.na(self_ideo) & !is.na(RacRes_n))\n}) %>% \n  .[sapply(., function(x) {\n    dim(x)[1] > 0\n  })] %>% \n  lapply(function(x) {\n    model <- lm(self_ideo ~ RacRes_n, data = x, weights = S017)\n    return(data.frame(s_id_rac = model$coefficients[2]))\n  }) %>% \n  do.call(rbind.data.frame, .) %>% \n  data.frame(country_wave = row.names(.), .) -> s_id_rac\n\nid_ec_rac <- inner_join(s_id_econ, s_id_rac)\n\ncombined <- sort(union(levels(W_EVS$country_wave), levels(id_ec_rac$country_wave)))\n\nleft_join(mutate(id_ec_rac, country_wave = factor(country_wave, levels = combined)), \n          mutate(unique(dplyr::select(W_EVS, country_wave, country, S020)), \n                 country_wave = factor(country_wave, levels = combined))) -> id_ec_rac\n\n## Create separate variables for each wave\n\nid_list <- id_ec_rac %>% dlply(\"country\")\n\nlapply(id_list, function(x) {\n  return(data.frame(wave_no = seq(1:nrow(x)), country_wave = x[1]))\n}) %>% \n  do.call(rbind.data.frame, .) %>% \n  left_join(id_ec_rac, .) -> id_ec_rac\n\nselect(id_ec_rac, s_id_econ, wave_no, country) %>% \n  spread(wave_no, s_id_econ) -> econ_waves \n\nnames(econ_waves) <- c(\"country\", \"id_ec_1\", \"id_ec_2\", \"id_ec_3\", \n                       \"id_ec_4\", \"id_ec_5\", \"id_ec_6\")\n\nselect(id_ec_rac, s_id_rac, wave_no, country) %>% \n  spread(wave_no, s_id_rac) -> rac_waves \n\nnames(rac_waves) <- c(\"country\", \"id_rac_1\", \"id_rac_2\", \"id_rac_3\", \n                       \"id_rac_4\", \"id_rac_5\", \"id_rac_6\")\n\nselect(id_ec_rac, country_wave, wave_no, country) %>% \n  spread(wave_no, country_wave) -> c_waves\n\nnames(c_waves) <- c(\"country\", \"wav_1\", \"wav_2\", \"wav_3\", \"wav_4\", \"wav_5\", \"wav_6\")\n\nleft_join(id_ec_rac, econ_waves) %>% \n  left_join(rac_waves) %>% \n  left_join(c_waves) -> id_viz\n\n### Visualization\n\nplot <- ggplot(data = id_viz, aes(x = s_id_econ, y = s_id_rac, colour = country)) + \n  geom_point_interactive(aes(x = id_ec_1, y = id_rac_1, tooltip = wav_1)) + \n  geom_point_interactive(aes(x = id_ec_2, y = id_rac_2, tooltip = wav_2)) + \n  geom_point_interactive(aes(x = id_ec_3, y = id_rac_3, tooltip = wav_3)) +\n  geom_point_interactive(aes(x = id_ec_4, y = id_rac_4, tooltip = wav_4)) +\n  geom_point_interactive(aes(x = id_ec_5, y = id_rac_5, tooltip = wav_5)) +\n  geom_point_interactive(aes(x = id_ec_6, y = id_rac_6, tooltip = wav_6)) +\n  geom_segment(aes(x = id_ec_1, y = id_rac_1, \n                   xend = id_ec_2, yend = id_rac_2), \n               arrow = arrow(length = unit(.1, \"inches\"))) + \n  geom_segment(aes(x = id_ec_2, y = id_rac_2, \n                   xend = id_ec_3, yend = id_rac_3), \n               arrow = arrow(length = unit(.1, \"inches\"))) + \n  geom_segment(aes(x = id_ec_3, y = id_rac_3, \n                   xend = id_ec_4, yend = id_rac_4), \n               arrow = arrow(length = unit(.1, \"inches\"))) + \n  geom_segment(aes(x = id_ec_4, y = id_rac_4, \n                   xend = id_ec_5, yend = id_rac_5), \n               arrow = arrow(length = unit(.1, \"inches\"))) + \n  geom_segment(aes(x = id_ec_5, y = id_rac_5, \n                   xend = id_ec_6, yend = id_rac_6), \n               arrow = arrow(length = unit(.1, \"inches\"))) +\n  labs(caption = \"Scatterplot with trends over time\", colour = \"Country\",\n       title = \"Effect of Economic Ideology  vs. Racial Resentment on Ideological Self-Placement\") + \n  scale_x_continuous(\"Effect of economic ideology on placement\", breaks = c(-4, -2, 0, 2, 4, 6, 8)) + \n  scale_y_continuous(\"Effect of racial resentment on placement\", breaks = c(-2, -1, 0, 1, 2, 3, 4)) + \n  theme(axis.title.x = element_text(size = 12), axis.title.y = element_text(size = 12), plot.title = element_text(size = 14)) + \n  coord_cartesian(xlim = c(-2, 8), ylim = c(-2, 3))\n\ngirafe(code = print(plot), width_svg = 8, height_svg = 8, pointsize = 10)\n",
    "created" : 1556031521915.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "383751825",
    "id" : "DCD8922",
    "lastKnownWriteTime" : 1556059650,
    "last_content_update" : 1556059650874,
    "path" : "~/Documents/WVS/wave trends viz.R",
    "project_path" : "wave trends viz.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 6,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}